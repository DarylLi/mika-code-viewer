{"version":3,"file":"bundle.esm.js","sources":["../src/main.js"],"sourcesContent":["import axios from \"axios\";\r\n\r\n/**\r\n *\r\n * ## renderFrameDom主渲染函数\r\n * @param {source} source\r\n * @param {option} options\r\n */\r\nconst renderFrameDom = async (source, options) => {\r\n  const { resourceLink, assetList, cdnLinks } = source;\r\n  let html = \"\",\r\n    css = \"\",\r\n    javascript = \"\";\r\n  async function getLinks() {\r\n    Promise.all([\r\n      await axios(`${resourceLink}/index.html`).then((res) => {\r\n        html = res.data;\r\n        return res;\r\n      }),\r\n      await axios(`${resourceLink}/index.js`).then((res) => {\r\n        javascript = res.data;\r\n        return res;\r\n      }),\r\n      await axios(`${resourceLink}/index.css`).then((res) => {\r\n        css = res.data;\r\n        return res;\r\n      }),\r\n    ])\r\n      .then((res) => {\r\n        console.log(res);\r\n      })\r\n      .catch((err) => {\r\n        console.log(err);\r\n      });\r\n  }\r\n  await getLinks();\r\n  // source of run code array\r\n  let runCdnList = [];\r\n  // get sources from link method\r\n  async function* requestListMaps() {\r\n    if (cdnLinks.length === 0) return;\r\n    let index = 0;\r\n    const requestMapList = cdnLinks.map(\r\n      (link) => () =>\r\n        new Promise(async (res, rej) => {\r\n          try {\r\n            res(await axios(link));\r\n          } catch (err) {\r\n            console.log(err);\r\n            // if request to codepen soure error, relink to local file\r\n            try {\r\n              res(\r\n                await axios(\r\n                  `${resourceLink}/${\r\n                    link.split(\"/\")[link.split(\"/\").length - 1]\r\n                  }`\r\n                )\r\n              );\r\n            } catch (othererr) {\r\n              console.log(othererr);\r\n              res(\"\");\r\n            }\r\n          }\r\n        })\r\n    );\r\n    try {\r\n      while (true) {\r\n        const res = await requestMapList[index]();\r\n        yield res;\r\n        if (index === requestMapList.length - 1) {\r\n          return;\r\n        }\r\n        index++;\r\n      }\r\n    } finally {\r\n    }\r\n  }\r\n  // request and get source from link\r\n  const getLinkStart = async () => {\r\n    for await (const result of requestListMaps()) {\r\n      runCdnList.push(result?.data);\r\n    }\r\n    return \"done\";\r\n  };\r\n  // await getLinkStart();\r\n  // replace souce link from codepen.io\r\n  let styleCode =\r\n    `html,body{width:100%;background:#fff;overflow:auto;margin:0px;height:100%;z-index:0;font-size:12px}\\n` +\r\n    css.replaceAll(\r\n      /https:\\/\\/assets.codepen.io\\/\\d{1,12}\\//g,\r\n      `${resourceLink}/`\r\n    );\r\n  let htmlCode = html.replaceAll(\r\n    /https:\\/\\/assets.codepen.io\\/\\d{1,12}\\//g,\r\n    `${resourceLink}/`\r\n  );\r\n  let jsCode = javascript;\r\n  // pollyfill for multiple dirs file\r\n  for (var link of assetList) {\r\n    styleCode = styleCode.replace(\r\n      link.includes(\"assets.codepen\")\r\n        ? `${resourceLink}/${[...link.split(\"/\")]\r\n            .slice(-(link.split(\"/\").length - 2))\r\n            .join(\"/\")}`\r\n        : `https://${link}`,\r\n      `${resourceLink}/${link.split(\"/\")[link.split(\"/\").length - 1]}`\r\n    );\r\n    htmlCode = htmlCode.replace(\r\n      link.includes(\"assets.codepen\")\r\n        ? `${resourceLink}/${[...link.split(\"/\")]\r\n            .slice(-(link.split(\"/\").length - 2))\r\n            .join(\"/\")}`\r\n        : `https://${link}`,\r\n      `${resourceLink}/${link.split(\"/\")[link.split(\"/\").length - 1]}`\r\n    );\r\n    afterTransCode = afterTransCode.replace(\r\n      link.includes(\"assets.codepen\")\r\n        ? `${resourceLink}/${[...link.split(\"/\")]\r\n            .slice(-(link.split(\"/\").length - 2))\r\n            .join(\"/\")}`\r\n        : `https://${link}`,\r\n      `${resourceLink}/${link.split(\"/\")[link.split(\"/\").length - 1]}`\r\n    );\r\n  }\r\n  // init style dom\r\n  const style = document.createElement(\"style\");\r\n  style.setAttribute(\"type\", \"text/css\");\r\n  style.innerHTML = styleCode;\r\n  // html\r\n  const htmlDom = document.createElement(\"html\");\r\n\r\n  const bodyDom = document.createElement(\"body\");\r\n\r\n  htmlDom.appendChild(style);\r\n  bodyDom.innerHTML = htmlCode;\r\n  // script dom\r\n  const jscontent = document.createElement(\"script\");\r\n  jscontent.setAttribute(\"type\", \"module\");\r\n  // prepare to handle some specifics\r\n  let js = `${jsCode}`.replaceAll(\r\n    /https:\\/\\/assets.codepen.io\\/\\d{1,12}\\//g,\r\n    `${resourceLink}/`\r\n  );\r\n  jscontent.innerHTML = js;\r\n  bodyDom.appendChild(jscontent);\r\n  // 最外层为html\r\n  htmlDom.appendChild(bodyDom);\r\n  const { width = \"100%\", height = \"100%\", target = null } = options;\r\n  //iframe dom\r\n  let curFrame = document.createElement(\"iframe\");\r\n  curFrame.setAttribute(\"width\", width);\r\n  curFrame.setAttribute(\"height\", height);\r\n  curFrame.setAttribute(\"style\", \"border:0px\");\r\n  curFrame.setAttribute(\"srcdoc\", `<!DOCTYPE html>${htmlDom.innerHTML}`);\r\n  target && document.querySelector(target).appendChild(curFrame);\r\n};\r\nexport { renderFrameDom };\r\n"],"names":[],"mappings":"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"}